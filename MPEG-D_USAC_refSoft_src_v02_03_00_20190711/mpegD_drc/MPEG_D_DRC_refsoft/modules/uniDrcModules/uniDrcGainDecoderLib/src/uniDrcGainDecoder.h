/***********************************************************************************
 
 This software module was originally developed by 
 
 Fraunhofer IIS
 
 in the course of development of the ISO/IEC 23003-4 for reference purposes and its 
 performance may not have been optimized. This software module is an implementation
 of one or more tools as specified by the ISO/IEC 23003-4 standard. ISO/IEC gives 
 you a royalty-free, worldwide, non-exclusive, copyright license to copy, distribute, 
 and make derivative works of this software module or modifications  thereof for use
 in implementations or products claiming conformance to the ISO/IEC 23003-4 standard 
 and which satisfy any specified conformance criteria. Those intending to use this 
 software module in products are advised that its use may infringe existing patents. 
 ISO/IEC have no liability for use of this software module or modifications thereof. 
 Copyright is not released for products that do not conform to the ISO/IEC 23003-4 
 standard.
  
 Fraunhofer IIS retains full right to modify and use the code for its own purpose,
 assign or donate the code to a third party and to inhibit third parties from using 
 the code for products that do not conform to MPEG-related ITU Recommendations and/or 
 ISO/IEC International Standards.
 
 This copyright notice must be included in all copies or derivative works. 
 
 Copyright (c) ISO/IEC 2014.
 
 ***********************************************************************************/

#ifndef _UNI_DRC_GAIN_DECODER_H_
#define _UNI_DRC_GAIN_DECODER_H_

#include "uniDrcGainDecoder_api.h"
#include "uniDrcCommon_api.h"
#include "uniDrcTables.h"
#include "uniDrcCommon.h"
#include "uniDrc.h"
#include "uniDrcGainDec.h"
#include "uniDrcFilterBank.h"
#include "uniDrcMultiBand.h"
#include "uniDrcProcessAudio.h"
#if MPEG_D_DRC_EXTENSION_V1
#include "uniDrcShapeFilter.h"
#include "uniDrcEq.h"
#include "uniDrcLoudEq.h"
#endif /* MPEG_D_DRC_EXTENSION_V1 */
#include "uniDrcDec.h"

#if AMD1_SYNTAX
#include "parametricDrcDecoder.h"
#endif /* AMD1_SYNTAX */

#ifdef __cplusplus
extern "C"
{
#endif

#ifndef M_PI
#define M_PI (3.14159265358979323846)
#endif

/* all structs that are originally called in decDrc() */
typedef struct T_UNI_DRC_GAIN_DEC_STRUCTS
{
    int audioChannelCount;
    DrcParams drcParams;
    DrcGainBuffers drcGainBuffers;
    AudioBandBuffer audioBandBuffer;
    OverlapParams overlapParams;
    FilterBanks filterBanks;
#if AMD1_SYNTAX
    AudioIOBuffer audioIOBuffer;
    PARAMETRIC_DRC_PARAMS parametricDrcParams;
#endif /* AMD1_SYNTAX */
#if MPEG_D_DRC_EXTENSION_V1
    ShapeFilterBlock shapeFilterBlock[CHANNEL_GROUP_COUNT_MAX];
    EqSet* eqSet;
#endif /* MPEG_D_DRC_EXTENSION_V1 */
}UNI_DRC_GAIN_DEC_STRUCTS;

#if AMD1_SYNTAX
static float f_bands_nrm_QMF71[71] = {
    0.004583300000000f,
    0.000833330000000f,
    0.002083300000000f,
    0.005875000000000f,
    0.009791700000000f,
    0.014292000000000f,
    0.019792000000000f,
    0.027000000000000f,
    0.035417000000000f,
    0.042625000000000f,
    0.056750000000000f,
    0.072375000000000f,
    0.088000000000000f,
    0.103620000000000f,
    0.119250000000000f,
    0.134870000000000f,
    0.150500000000000f,
    0.166120000000000f,
    0.181750000000000f,
    0.197370000000000f,
    0.213000000000000f,
    0.228620000000000f,
    0.244250000000000f,
    0.259880000000000f,
    0.275500000000000f,
    0.291130000000000f,
    0.306750000000000f,
    0.322380000000000f,
    0.338000000000000f,
    0.353630000000000f,
    0.369250000000000f,
    0.384880000000000f,
    0.400500000000000f,
    0.416130000000000f,
    0.431750000000000f,
    0.447380000000000f,
    0.463000000000000f,
    0.478630000000000f,
    0.494250000000000f,
    0.509870000000000f,
    0.525500000000000f,
    0.541120000000000f,
    0.556750000000000f,
    0.572370000000000f,
    0.588000000000000f,
    0.603620000000000f,
    0.619250000000000f,
    0.634870000000000f,
    0.650500000000000f,
    0.666120000000000f,
    0.681750000000000f,
    0.697370000000000f,
    0.713000000000000f,
    0.728620000000000f,
    0.744250000000000f,
    0.759870000000000f,
    0.775500000000000f,
    0.791120000000000f,
    0.806750000000000f,
    0.822370000000000f,
    0.838000000000000f,
    0.853620000000000f,
    0.869250000000000f,
    0.884870000000000f,
    0.900500000000000f,
    0.916120000000000f,
    0.931750000000000f,
    0.947370000000000f,
    0.963000000000000f,
    0.974540000000000f,
    0.999040000000000f
};

static float f_bands_nrm_QMF64[64] = {
    0.0078125000000000f,
    0.0234380000000000f,
    0.0390620000000000f,
    0.0546880000000000f,
    0.0703120000000000f,
    0.0859380000000000f,
    0.1015600000000000f,
    0.1171900000000000f,
    0.1328100000000000f,
    0.1484400000000000f,
    0.1640600000000000f,
    0.1796900000000000f,
    0.1953100000000000f,
    0.2109400000000000f,
    0.2265600000000000f,
    0.2421900000000000f,
    0.2578100000000000f,
    0.2734400000000000f,
    0.2890600000000000f,
    0.3046900000000000f,
    0.3203100000000000f,
    0.3359400000000000f,
    0.3515600000000000f,
    0.3671900000000000f,
    0.3828100000000000f,
    0.3984400000000000f,
    0.4140600000000000f,
    0.4296900000000000f,
    0.4453100000000000f,
    0.4609400000000000f,
    0.4765600000000000f,
    0.4921900000000000f,
    0.5078100000000000f,
    0.5234400000000000f,
    0.5390600000000000f,
    0.5546900000000000f,
    0.5703100000000000f,
    0.5859400000000000f,
    0.6015600000000000f,
    0.6171900000000000f,
    0.6328100000000000f,     
    0.6484400000000000f,     
    0.6640600000000000f,     
    0.6796900000000000f,     
    0.6953100000000000f,     
    0.7109400000000000f,     
    0.7265600000000000f,     
    0.7421900000000000f,     
    0.7578100000000000f,     
    0.7734400000000000f,     
    0.7890600000000000f,     
    0.8046900000000000f,     
    0.8203100000000000f,     
    0.8359400000000000f,     
    0.8515600000000000f,    
    0.8671900000000000f,    
    0.8828100000000000f,     
    0.8984400000000000f,     
    0.9140600000000000f,     
    0.9296900000000000f,     
    0.9453100000000000f,     
    0.9609400000000000f,    
    0.9765600000000000f,   
    0.9921900000000000f        
};

static float f_bands_nrm_STFT256[257]={
    0.000000000000000f,
    0.003906250000000f,
    0.007812500000000f,
    0.011718750000000f,
    0.015625000000000f,
    0.019531250000000f,
    0.023437500000000f,
    0.027343750000000f,
    0.031250000000000f,
    0.035156250000000f,
    0.039062500000000f,
    0.042968750000000f,
    0.046875000000000f,
    0.050781250000000f,
    0.054687500000000f,
    0.058593750000000f,
    0.062500000000000f,
    0.066406250000000f,
    0.070312500000000f,
    0.074218750000000f,
    0.078125000000000f,
    0.082031250000000f,
    0.085937500000000f,
    0.089843750000000f,
    0.093750000000000f,
    0.097656250000000f,
    0.101562500000000f,
    0.105468750000000f,
    0.109375000000000f,
    0.113281250000000f,
    0.117187500000000f,
    0.121093750000000f,
    0.125000000000000f,
    0.128906250000000f,
    0.132812500000000f,
    0.136718750000000f,
    0.140625000000000f,
    0.144531250000000f,
    0.148437500000000f,
    0.152343750000000f,
    0.156250000000000f,
    0.160156250000000f,
    0.164062500000000f,
    0.167968750000000f,
    0.171875000000000f,
    0.175781250000000f,
    0.179687500000000f,
    0.183593750000000f,
    0.187500000000000f,
    0.191406250000000f,
    0.195312500000000f,
    0.199218750000000f,
    0.203125000000000f,
    0.207031250000000f,
    0.210937500000000f,
    0.214843750000000f,
    0.218750000000000f,
    0.222656250000000f,
    0.226562500000000f,
    0.230468750000000f,
    0.234375000000000f,
    0.238281250000000f,
    0.242187500000000f,
    0.246093750000000f,
    0.250000000000000f,
    0.253906250000000f,
    0.257812500000000f,
    0.261718750000000f,
    0.265625000000000f,
    0.269531250000000f,
    0.273437500000000f,
    0.277343750000000f,
    0.281250000000000f,
    0.285156250000000f,
    0.289062500000000f,
    0.292968750000000f,
    0.296875000000000f,
    0.300781250000000f,
    0.304687500000000f,
    0.308593750000000f,
    0.312500000000000f,
    0.316406250000000f,
    0.320312500000000f,
    0.324218750000000f,
    0.328125000000000f,
    0.332031250000000f,
    0.335937500000000f,
    0.339843750000000f,
    0.343750000000000f,
    0.347656250000000f,
    0.351562500000000f,
    0.355468750000000f,
    0.359375000000000f,
    0.363281250000000f,
    0.367187500000000f,
    0.371093750000000f,
    0.375000000000000f,
    0.378906250000000f,
    0.382812500000000f,
    0.386718750000000f,
    0.390625000000000f,
    0.394531250000000f,
    0.398437500000000f,
    0.402343750000000f,
    0.406250000000000f,
    0.410156250000000f,
    0.414062500000000f,
    0.417968750000000f,
    0.421875000000000f,
    0.425781250000000f,
    0.429687500000000f,
    0.433593750000000f,
    0.437500000000000f,
    0.441406250000000f,
    0.445312500000000f,
    0.449218750000000f,
    0.453125000000000f,
    0.457031250000000f,
    0.460937500000000f,
    0.464843750000000f,
    0.468750000000000f,
    0.472656250000000f,
    0.476562500000000f,
    0.480468750000000f,
    0.484375000000000f,
    0.488281250000000f,
    0.492187500000000f,
    0.496093750000000f,
    0.500000000000000f,
    0.503906250000000f,
    0.507812500000000f,
    0.511718750000000f,
    0.515625000000000f,
    0.519531250000000f,
    0.523437500000000f,
    0.527343750000000f,
    0.531250000000000f,
    0.535156250000000f,
    0.539062500000000f,
    0.542968750000000f,
    0.546875000000000f,
    0.550781250000000f,
    0.554687500000000f,
    0.558593750000000f,
    0.562500000000000f,
    0.566406250000000f,
    0.570312500000000f,
    0.574218750000000f,
    0.578125000000000f,
    0.582031250000000f,
    0.585937500000000f,
    0.589843750000000f,
    0.593750000000000f,
    0.597656250000000f,
    0.601562500000000f,
    0.605468750000000f,
    0.609375000000000f,
    0.613281250000000f,
    0.617187500000000f,
    0.621093750000000f,
    0.625000000000000f,
    0.628906250000000f,
    0.632812500000000f,
    0.636718750000000f,
    0.640625000000000f,
    0.644531250000000f,
    0.648437500000000f,
    0.652343750000000f,
    0.656250000000000f,
    0.660156250000000f,
    0.664062500000000f,
    0.667968750000000f,
    0.671875000000000f,
    0.675781250000000f,
    0.679687500000000f,
    0.683593750000000f,
    0.687500000000000f,
    0.691406250000000f,
    0.695312500000000f,
    0.699218750000000f,
    0.703125000000000f,
    0.707031250000000f,
    0.710937500000000f,
    0.714843750000000f,
    0.718750000000000f,
    0.722656250000000f,
    0.726562500000000f,
    0.730468750000000f,
    0.734375000000000f,
    0.738281250000000f,
    0.742187500000000f,
    0.746093750000000f,
    0.750000000000000f,
    0.753906250000000f,
    0.757812500000000f,
    0.761718750000000f,
    0.765625000000000f,
    0.769531250000000f,
    0.773437500000000f,
    0.777343750000000f,
    0.781250000000000f,
    0.785156250000000f,
    0.789062500000000f,
    0.792968750000000f,
    0.796875000000000f,
    0.800781250000000f,
    0.804687500000000f,
    0.808593750000000f,
    0.812500000000000f,
    0.816406250000000f,
    0.820312500000000f,
    0.824218750000000f,
    0.828125000000000f,
    0.832031250000000f,
    0.835937500000000f,
    0.839843750000000f,
    0.843750000000000f,
    0.847656250000000f,
    0.851562500000000f,
    0.855468750000000f,
    0.859375000000000f,
    0.863281250000000f,
    0.867187500000000f,
    0.871093750000000f,
    0.875000000000000f,
    0.878906250000000f,
    0.882812500000000f,
    0.886718750000000f,
    0.890625000000000f,
    0.894531250000000f,
    0.898437500000000f,
    0.902343750000000f,
    0.906250000000000f,
    0.910156250000000f,
    0.914062500000000f,
    0.917968750000000f,
    0.921875000000000f,
    0.925781250000000f,
    0.929687500000000f,
    0.933593750000000f,
    0.937500000000000f,
    0.941406250000000f,
    0.945312500000000f,
    0.949218750000000f,
    0.953125000000000f,
    0.957031250000000f,
    0.960937500000000f,
    0.964843750000000f,
    0.968750000000000f,
    0.972656250000000f,
    0.976562500000000f,
    0.980468750000000f,
    0.984375000000000f,
    0.988281250000000f,
    0.992187500000000f,
    0.996093750000000f,
    1.000000000000000f
};
    
#endif /* AMD1_SYNTAX */
    
#ifdef __cplusplus
}
#endif
#endif /* _UNI_DRC_GAIN_DECODER_H_ */

